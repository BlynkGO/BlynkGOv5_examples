#include <BlynkGOv5.h>

GRect FrameScroll;            // ‡∏ß‡∏¥‡∏ï‡πÄ‡∏à‡πá‡∏ï‡∏ô‡∏≠‡∏Å ‡πÑ‡∏ß‡πâ‡∏ó‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏≠‡∏á view ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á ‡∏ï‡∏±‡∏ß scroll
  GRect rect(FrameScroll);    // ‡∏ß‡∏¥‡∏ï‡πÄ‡∏à‡πá‡∏ï‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡∏Å‡∏ß‡πà‡∏≤ ‡∏ä‡πà‡∏≠‡∏á view

void setup(){
  Serial.begin(9600); Serial.println();
  BlynkGO.begin();

  FrameScroll.size(300,300);                // ‡∏Ç‡∏ô‡∏≤‡∏î FrameScroll ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏≠‡∏á view ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏ß‡πà‡∏≤ ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ñ‡∏π‡∏Å scroll
  FrameScroll.scrollable(true);             // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ scroll ‡πÑ‡∏î‡πâ
  FrameScroll.scrollbar(SCROLLBAR_OFF);     // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ñ‡∏ö scrollbar
  FrameScroll.scroll_elastic(false);        // ‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≤‡∏¢ ‡πÄ‡∏ß‡∏•‡∏≤ scroll ‡πÑ‡∏õ‡∏ñ‡∏∂‡∏á ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏¥‡∏Å‡πÄ‡∏î‡πâ‡∏á
  FrameScroll.bg_opa(0);                    // ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á ‡πÉ‡∏ä‡πâ‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡πâ‡∏≤‡∏ô scroll
    rect.size(300, 1000);                   // ‡∏ß‡∏¥‡∏ï‡πÄ‡∏à‡πá‡∏ï‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô content ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡∏Å‡∏ß‡πà‡∏≤ FrameScroll
    rect.color(TFT_BLUE, TFT_RED);
    rect.align(ALIGN_TOP_LEFT);
    rect.onDrawMain(GWIDGET_CB{             // ‡∏ß‡∏≤‡∏î‡∏™‡∏¥‡πà‡∏á‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô rect ‡∏î‡πâ‡∏ß‡∏¢ ‡∏Å‡∏£‡∏≤‡∏ü‡∏¥‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏≠‡∏á ‡πÅ‡∏ö‡∏ö ‡πÑ‡∏°‡πà‡∏û‡∏∂‡πà‡∏á‡∏ß‡∏¥‡∏ï‡πÄ‡∏à‡πá‡∏ï 
      for(int i=0; i<20; i++){
        // ‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏•‡πà‡∏≤‡∏á ‡∏à‡∏≤‡∏Å‡∏à‡∏∏‡∏î 2 ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ 1 px ‡πÅ‡∏ö‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∞ ‡∏Å‡∏ß‡πâ‡∏≤‡∏á 4px ‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏ß‡πâ‡∏ô‡∏õ‡∏£‡∏∞ 4px ‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™ 30% (‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÄ‡∏°‡πá‡∏°‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ï‡πÄ‡∏à‡πá‡∏ï GLine)
        if(i>0) rect.softdrawLine(Point(0, i*50), Point(rect.width()-1,i*50), 1, 4, 4, TFT_WHITE, OPA_30);
        // ‡∏ß‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏•‡πà‡∏≤‡∏á ‡∏î‡πâ‡∏ß‡∏¢‡∏ü‡∏≠‡∏ô‡∏ï‡πå ‡∏™‡∏µ ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á align ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÄ‡∏°‡πá‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏¥‡∏ï‡πÄ‡∏à‡πá‡∏ï GLabel)
        rect.softdrawLabel(StringX::printf("%d",i*50), prasanmit_18, TFT_WHITE, ALIGN_TOP, 0, i*50);
      }
    });

  //----------- Scroll ‡∏°‡∏µ‡∏Å‡∏≤‡∏£ Snape ‡∏ó‡∏µ‡πà ‡∏ó‡∏∏‡∏Å‡πÜ 100 px --------------------
  // üìå ‡πÄ‡∏û‡∏¥‡πà‡∏° event ‡πÉ‡∏´‡πâ Scroll ‡∏°‡∏µ‡∏Å‡∏≤‡∏£ Snap ‡∏ó‡∏∏‡∏Å‡πÜ 100px
  //---------------------------------------------------------------
  FrameScroll.event_cb([](GWIDGET, event_t event)  {
    if(event == EVENT_SCROLL_END){
      int32_t y = FrameScroll.scroll_y();  // ‡∏Ñ‡πà‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á scroll ‡πÅ‡∏Å‡∏ô y ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
      int32_t step = 100;
      // ‡∏´‡∏≤ step ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
      int32_t y_snapped = ((y + step/2) / step) * step;
      // ‡∏™‡∏±‡πà‡∏á scroll ‡πÅ‡∏ö‡∏ö smooth ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á snap
      FrameScroll.scroll_to_y(y_snapped, 200); // 200ms animation
    }
  });

  //----------- Best Snape ‡∏ï‡∏≤‡∏° vector snapes ---------------------
  // üìå ‡πÄ‡∏û‡∏¥‡πà‡∏° event ‡πÉ‡∏´‡πâ Best Snap ‡∏ï‡∏≤‡∏° vector snaps
  //--------------------------------------------------------------
  // FrameScroll.event_cb([](GWIDGET, event_t event)  {
  //   if(event == EVENT_SCROLL_END){
  //     // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á snap ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
  //     std::vector<int32_t> snaps = {0, 75, 150, 200, 400, 600, 700};

  //     int32_t y = FrameScroll.scroll_y();   // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
  //     int32_t best_snap = snaps[0];
  //     int32_t best_diff = abs(y - snaps[0]);

  //     // ‡∏´‡∏≤ snap point ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
  //     for(size_t i=1; i<snaps.size(); i++){
  //       int32_t diff = abs(y - snaps[i]);
  //       if(diff < best_diff){
  //         best_diff = diff;
  //         best_snap = snaps[i];
  //       }
  //     }

  //     // scroll ‡πÑ‡∏õ‡∏¢‡∏±‡∏á snap ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
  //     FrameScroll.scroll_to_y(best_snap, 200);
  //   }
  // });
}

void loop(){
  BlynkGO.update();
}
